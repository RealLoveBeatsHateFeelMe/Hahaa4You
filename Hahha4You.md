# Hahha4You 功能需求文档

## 一、悬浮小球 (Floating Ball)

### 1.1 基本属性
- [x] 大小：60x60px
- [x] 始终置顶 (alwaysOnTop)
- [x] 无边框透明窗口
- [x] 可拖动

### 1.2 边缘吸附
- [x] 拖动结束后自动吸附到最近的屏幕边缘（左/右/上/下）
- [x] 只能停留在屏幕四边，不能在中间

### 1.3 半隐藏模式
- [x] 默认状态：小球一半隐藏在屏幕边缘外
- [x] 鼠标悬停时：完整显示小球
- [x] 鼠标离开后：延迟300ms后恢复半隐藏

---

## 二、预览窗口 (Preview - "Hey, I see you~")

### 2.1 触发条件
- [x] 鼠标悬停在小球上200ms后显示 - **已修复**
- [x] 预览窗口根据小球位置动态定位（左边球→右边显示，右边球→左边显示等）

### 2.2 内容
- [x] 显示动画插图："Hey, I see you~"
- [x] 眼睛动画（瞳孔转动）
- [x] 闪烁星星效果
- [x] 文字波浪动画

### 2.3 隐藏条件
- [x] 鼠标离开小球时隐藏
- [x] 2秒后自动显示笑话框时隐藏
- [x] 双击触发弹跳动画后隐藏（动画结束时）

---

## 三、笑话窗口 (Joke Window)

### 3.1 触发条件
- [x] 单击小球显示
- [x] 悬停超过2秒自动显示

### 3.2 内容
- [x] 显示随机笑话（19条中文笑话）
- [x] 保留笑话原始排版（换行符）
- [x] 文字左对齐

### 3.3 位置
- [x] 根据小球边缘位置动态定位
- [x] 拖动小球时笑话窗口跟随移动

### 3.4 "下一个"按钮动画
- [x] 点击后笑话窗口执行碰撞动画
- [x] 水平方向（左右边缘小球）：左右碰撞
- [x] 垂直方向（上下边缘小球）：上下碰撞
- [x] 动画丝滑，使用缓动函数

### 3.5 关闭
- [x] 点击关闭按钮关闭
- [x] 双击小球时关闭

---

## 四、双击弹跳动画 (Bounce Animation)

### 4.1 触发
- [x] 双击小球触发
- [x] 触发时关闭笑话窗口
- [x] 触发时取消2秒自动显示计时器
- [x] 防止连续点击触发多个动画 (isBouncing 标志)

### 4.2 动画效果
- [x] 小球和预览窗口同时弹跳
- [x] 真实物理模拟（速度、摩擦、弹性碰撞）
- [x] 2.5秒自由弹跳 → 0.3秒停顿 → 0.4秒平滑返回原位
- [x] 预览窗口在返回阶段隐藏

### 4.3 碰撞感觉要求
- [x] 爆发式起始速度（ballVelX=150, ballVelY=-130）
- [x] 超强震颤效果（shakeIntensity=80, shakeFreq=100）
- [x] 超高弹性：摩擦力 0.994，弹性损失 0.93
- [x] 台球般的碰撞手感

---

## 五、修复记录

### 已修复
1. **预览窗口不稳定** - 添加 `isDestroyed()` 检查，使用 `showInactive()` 避免抢焦点
2. **碰撞动画不真实** - 改用物理模拟，速度+摩擦+弹性碰撞
3. **连续点击bug** - 添加 `isBouncing` 标志防止多次触发
4. **震颤不明显** - 增强震颤强度(80)和频率(100)
5. **弹力不够强** - 提升起始速度(150/-130)，弹性损失降至0.93
6. **动画结束突兀** - 弹跳后停顿0.3秒，再平滑返回原位

---

## 六、技术栈

- Electron (electron-forge)
- @electron/remote
- 纯CSS动画（预览窗口眼睛/星星/文字）
- JavaScript物理模拟（弹跳动画）
- IPC通信（主进程↔渲染进程）

